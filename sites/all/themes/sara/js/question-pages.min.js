$=jQuery;$(document).ready(function(){var a=$(".page-question.node-type-questions");$(".page-question-list .field-name-field-experts a").each(function(){$(this).wrap('<div class="field-item"></div>')});$(".page-question .field-name-field-experts a").each(function(){var f=$(this).attr("href");var e=f.split("/");$(this).attr("id",e[2]);$(this).after('<div class="information"><div class="pic"></div><div class="data"><div></div><div></div></div></div>')});var d;$(".page-question .field-name-field-experts .field-item > a").on("mouseenter",function(){$(this).parent().addClass("open");if(!$(this).next(".information").hasClass("filled")){var f=$(this).attr("id");var e=$(this);d=$.ajax({type:"POST",url:"/experts/information",data:{tid:f},success:function(g){e.next(".information").html('<div class="pic"><image src="'+g[0]["pic"]+'"/></div><div class="data"><div class="q-count">  سوالات این تخصص : '+g[0]["question_count"]+' </div><div class="u-count"> کاربران این تخصص : '+g[0]["user_count"]+'</div><a href="/node/'+g[0]["nid"]+'" target="_blank">دانشنامه</a></div>');e.next(".information").addClass("filled")},error:function(g){}})}});$(".page-question .field-name-field-experts .field-item").on("mouseleave",function(){$(this).removeClass("open");if(d){d.abort()}});$(".page-question .field-name-field-experts .field-item").each(function(){var e=$(this).find("a");e.attr("href","/question/list?field_experts_tid="+e.text());e.attr("target","_blank")});$(".page-question-list .views-field-field-experts a").each(function(){$(this).attr("href","/question/list?field_experts_tid="+$(this).text())});if(Drupal.settings.status){a.addClass(Drupal.settings.status);a.find("#comments form").slideUp();a.find("#comments h2.title.comment-form").removeClass("open")}else{a.find("#comments h2.title.comment-form").addClass("open")}a.find("#comments h2.title.comment-form").click(function(){if(!Drupal.settings.status){$(this).toggleClass("open");a.find("#comments form").slideToggle()}});var b=advisor_prove=0;a.find(".content .comment").each(function(){if($(this).find(".field-name-field-prove-asker .field-item").text()=="1"){$(this).addClass("proved_by_asker");b=1}});a.find(".content .comment").each(function(){if($(this).find(".field-name-field-prove-advisor .field-item").text()=="1"){$(this).addClass("proved_by_advisor");advisor_prove=1}});a.find("#comments > .comment:last-of-type").addClass("last-comment-advisor");a.find(".content .comment .field-name-field-prove-asker").attr("title","تایید شده توسط نویسنده سوال");a.find(".content .comment.proved_by_advisor > div.group-left").attr("title","تایید شده توسط مشاور");a.find(".content .comment.author-advisor > div.group-left").attr("title","پاسخ داده شده توسط مشاور");if(b==0&&(Drupal.settings.Uid==Drupal.settings.asker||a.hasClass("role-administrator"))){a.find(".content .comment").each(function(){var e=$(this).prev().attr("id");var f=e.substr(e.indexOf("-")+1);if(!$(this).parent().hasClass("indented")){$(this).find(".group-left ul").append('<li id="'+f+'" class="asker_aprove"><a>تایید نویسنده سوال</a></li>')}})}if((advisor_prove==0)&&(a.hasClass("role-advisor")||a.hasClass("role-administrator"))){a.find(".content .comment").each(function(){if(!$(this).hasClass("author-advisor")){var e=$(this).prev().attr("id");var f=e.substr(e.indexOf("-")+1);if(!$(this).parent().hasClass("indented")){$(this).find(".group-left ul").append('<li id="'+f+'" class="advisor_aprove"><a>تایید مشاور</a></li>')}}})}a.find(".advisor_aprove > a").on("click",function(){$(this).after('<div class="ajax-progress ajax-progress-throbber"><div class="throbber"></div></div>');var e=$(this).parent().attr("id");$.ajax({type:"POST",url:"/comment/prove/advisor/"+e,success:function(f){if(f[0]==1){$("#"+f[1]).closest(".comment").addClass("proved_by_advisor");a.find(".content .comment").each(function(){$(this).find(".group-left .advisor_aprove").remove()});$("#"+f[1]).find(".ajax-progress.ajax-progress-throbber").hide()}},error:function(f){console.log(f)}})});a.find(".asker_aprove > a").on("click",function(){$(this).after('<div class="ajax-progress ajax-progress-throbber"><div class="throbber"></div></div>');var e=$(this).parent().attr("id");$.ajax({type:"POST",url:"/comment/prove/asker/"+e,success:function(f){if(f[0]==1){$("#"+f[1]).closest(".comment").addClass("proved_by_asker");a.find(".content .comment").each(function(){$(this).find(".group-left .asker_aprove").remove()});$("#"+f[1]).find(".ajax-progress.ajax-progress-throbber").hide()}},error:function(f){console.log(f)}})});a.find("#comments h2.title.comment-form").attr("id","answer-question");a.find(".answer_link > a").click(function(f){f.preventDefault();if(a.hasClass("not-logged-in")){a.find("#block-panels-mini-user-panel h2.block-title").click()}else{$("html, body").animate({scrollTop:($("#answer-question").offset().top-80)},700)}});$(".field-name-question-statistic .statistics").prepend('<div class="share-title">اشتراک</div>');a.find(".node-questions.view-mode-full > .group-header .field-name-question-statistic .statistics .share-title").click(function(){$(".node-questions.view-mode-full > .group-header .field-name-field-social-share").toggleClass("open");$(".node-questions.view-mode-full > .group-header .field-name-field-social-share .field-items").slideToggle()});$(".node-questions.view-mode-full.node-unpublished > .group-header .flag-outer.flag-outer-follow-question").before('<div class="not-published-btn"> تایید نشده </div>');if(Drupal.settings.Uid==Drupal.settings.asker){var c=window.location.pathname.split("/")[2];$(".node-questions.view-mode-full > .group-header .flag-outer.flag-outer-follow-question").before('<div class="edit-link"><a href="/node/'+c+'/edit" target="_blank" >ویرایش</a></div>')}});Drupal.behaviors.question_pages={attach:function(a,b){$(".node-questions .comment-form .username:not(.has-img)").each(function(f){var c=$(this).attr("href").split("/");var e=$(this);var d="";$.ajax({url:"/user/"+c[2]+"/ajax/picture",success:function(g){var h=$.parseHTML(g.data);e.prepend(h);e.addClass("has-img")}})});$(".page-question.node-type-questions").find(".indented").each(function(){$(this).find(".group-left .group-more").each(function(){console.log($(this).find("ul").children().length);if($(this).find("ul").children().length>1){$(this).find(".comment-reply").css({display:"none"})}else{if($(this).find("ul").children().length==1){$(this).css({display:"none"})}}})})}};